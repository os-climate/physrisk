from typing import Sequence
from physrisk.kernel.hazard_model import HazardDataRequest, HazardDataResponse
from physrisk.kernel.assets import Asset
from physrisk.kernel.hazard_model import HazardParameterDataResponse
from physrisk.kernel.impact_distrib import ImpactDistrib
from physrisk.kernel.vulnerability_model import VulnerabilityModelBase


class HazardPassThroughModel(VulnerabilityModelBase):
    """Simple vulnerability model that passes through the hazard parameter as the impact."""

    def __init__(self, hazard_type: type, indicator_id: str):
        """Initialize a simple vulnerability model that passes through the hazard parameter as the impact."""
        self.indicator_id = indicator_id
        self.hazard_type = hazard_type

    def get_data_requests(
        self, asset: Asset, *, scenario: str, year: int
    ) -> HazardDataRequest:
        """Provide the list of hazard event data requests required in order to calculate the VulnerabilityDistrib and HazardEventDistrib for the asset."""
        return HazardDataRequest(
            self.hazard_type,
            asset.longitude,
            asset.latitude,
            scenario=scenario,
            year=year,
            indicator_id=self.indicator_id,
        )

    def get_impact(
        self, asset: Asset, hazard_data: Sequence[HazardDataResponse]
    ) -> ImpactDistrib:
        """Calculate the impact distribution based on hazard data responses."""
        (data,) = hazard_data
        assert isinstance(data, HazardParameterDataResponse)
        return ImpactDistrib(
            self.hazard_type, [data.parameter, data.parameter], [1], [data.path]
        )
